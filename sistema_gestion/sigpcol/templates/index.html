{% extends 'base.html' %}
{% load static %}
{% block content %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Incluye Chart.js para los gráficos -->
</head>
<body>
    <div style="position: absolute; top: 10px; right: 10px; background-color: #f1f1f1; padding: 5px; border-radius: 5px;">
        Tasa de Cambio Actual: {{ exchange_rate }}
    </div>

    <header class="bg-primary text-white text-center py-4">
        <h3>SISTEMA INTEGRAL DE GESTION PARA COLEGIOS</h3>
    </header>

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            

    <main class="container my-4">
        <div class="row">
            <div class="col-md-12">
                <p>Selecciona una opción del menú para comenzar.</p>

                <!-- Estadísticas -->
                <div class="my-4">
                    <h2>Estado de la Cobranza</h2>
                    <form method="GET" action="">
                        <div class="mb-3">
                            <label for="chart_academic_year" class="form-label">Filtrar por Ciclo Lectivo:</label>
                            <select id="chart_academic_year" name="chart_academic_year" class="form-select" onchange="this.form.submit()">
                                <option value="">Seleccionar</option>
                                {% for year in academic_years %}
                                    <option value="{{ year.id }}" {% if year.id|stringformat:"s" == request.GET.chart_academic_year %}selected{% endif %}>{{ year }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </form>
                    <canvas id="barChart" width="400" height="150"></canvas> <!-- Ajustar tamaño del canvas -->
                </div>
                
                <script>
                    function updateChart() {
    var selectedYear = document.getElementById('chart_academic_year').value;

    // Aquí deberías realizar la lógica para actualizar los datos de la gráfica según el ciclo lectivo seleccionado
    var totalPaid = {{ total_paid }};
    var totalDue = {{ total_due }};

    barChart.data.datasets[0].data = [totalPaid, totalDue];
    barChart.update();
}

var ctx = document.getElementById('barChart').getContext('2d');
var barChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ['Pagado', 'Pendiente'],
        datasets: [{
            label: 'Estado de la Cobranza',
            data: [{{ total_paid }}, {{ total_due }}],
            backgroundColor: ['#4caf50', '#f44336']
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true
            }
        },
        plugins: {
            legend: {
                display: false
            },
            tooltip: {
                callbacks: {
                    label: function(tooltipItem) {
                        return tooltipItem.label + ': ' + tooltipItem.raw;
                    }
                }
            }
        }
    }
});

                </script>
            </div>
        </div>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
{% endblock %}